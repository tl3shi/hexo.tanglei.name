---
title: æå‡å¼€å‘æ•ˆç‡Nå€çš„20+å‘½ä»¤è¡Œç¥å™¨!(é™„ demo)
layout: post
categories:
  - ç»éªŒæŠ€å·§
tags:
  - MyLife
  - Shell
  - Mac
---


>å…³äºä½œè€…ï¼šç¨‹åºçŒ¿çŸ³å¤´(ID: tangleithu)ï¼Œç°ä»»é˜¿é‡Œå·´å·´æŠ€æœ¯ä¸“å®¶ï¼Œæ¸…åå­¦æ¸£ï¼Œå‰å¤§ç–†åç«¯ Leaderã€‚ä»¥æ¯ç¯‡æ–‡ç« éƒ½è®©äººæœ‰æ”¶è·ä¸ºç›®çš„ï¼Œæ¬¢è¿å…³æ³¨ï¼Œäº¤æµå’ŒæŒ‡å¯¼ï¼æ–‡ç« é¦–å‘äº[å¾®ä¿¡å…¬ä¼—å·](https://mp.weixin.qq.com/s?__biz=MzI3OTUzMzcwNw==&mid=2247489026&idx=1&sn=cf1650652a44d65730c5ee04258ad9e1&chksm=eb4717e6dc309ef037674943645abe8356aa726416ea46f3349ba227520bd40c95f8a49aa3e5&token=553253061&lang=zh_CN#rd)ï¼Œæ¬¢è¿å…³æ³¨ã€‚åå°å›å¤å…³é”®å­— â€œ1024â€ è·å–ç¨‹åºå‘˜å¤§å‚é¢è¯•æŒ‡å—ã€‚

è¯»è€…ç¦åˆ©ï¼š[ç‚¹è¿™é‡Œé€å‡ æœ¬æˆ‘ä»¬éƒ¨é—¨å‡ºçš„æ–°ä¹¦â€”â€”ã€Šå¼¹æ€§è®¡ç®—ï¼šæ— å¤„ä¸åœ¨çš„ç®—åŠ›ã€‹](https://mp.weixin.qq.com/s?__biz=MzI3OTUzMzcwNw==&mid=2247488892&idx=1&sn=1b026c5a8688b880ca06c51c816265b1&chksm=eb471498dc309d8eaac5bd296a3971901e624e9abfc5a0add8928f5ebc3a83b8402ebfadd95d&scene=21&token=1758347384&lang=zh_CN#wechat_redirect)ï¼Œå…è´¹åŒ…é‚®åˆ°å®¶ï¼Œæ¬¢è¿å¤§å®¶æ¥æŠ½å¥–ï¼Œä¹Ÿå¸®å¿™ review ä¸‹æŠ½å¥–çš„ä»£ç ã€‚

æœ¬æ–‡ä¸»è¦æ¥æºäºåœ¨ä¹‹å‰å…¬å¸çš„å°ç»„å†…éƒ¨çš„ä¸€ä¸ªå°åˆ†äº«ï¼Œæ•´ç†æˆä¸€ç¯‡æ–‡ç« poå‡ºæ¥ã€‚
é¢˜ç›®å« â€œShell åŠ©åŠ›å¼€å‘æ•ˆç‡æå‡â€ï¼Œæ›´åˆ‡é¢˜çš„åº”è¯¥æ˜¯å«â€œå‘½ä»¤è¡Œâ€æå‡å¼€å‘æ•ˆç‡ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰è®²åˆ° Shell ç¼–ç¨‹ï¼Œè€Œæ˜¯ä¸»è¦ä»‹ç» Linux æˆ–è€… Mac ä¸‹å¸¸ç”¨çš„ä¸€äº›åŸºæœ¬å·¥å…·å‘½ä»¤æ¥å¸®åŠ©å¤„ç†ä¸€äº›æ—¥å¸¸äº‹åŠ¡ã€‚

é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œä½ åº”è¯¥å¯¹ç›¸å…³å‘½ä»¤æœ‰ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼ŒçŸ¥é“æ¯”å¦‚ç”¨ä»€ä¹ˆå‘½ä»¤å¯ä»¥å®Œæˆæ€æ ·çš„æ“ä½œï¼Œ 
è‡³äºå…·ä½“çš„å‚æ•°ï¼Œä¸éœ€è¦åˆ»æ„åœ°èƒŒè¯µï¼Œç­‰åˆ°éœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼Œå†å» `cmd --help ` æˆ–è€… `man cmd`ï¼Œç”¨å¾—å¤šäº†ï¼Œå¸¸ç”¨çš„å‘½ä»¤ä¹Ÿå°±è‡ªç„¶è®°ä½äº†ã€‚ 

æœ¬æ–‡é¦–å…ˆä»‹ç»äº† Linux/Mac ä¸‹ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç„¶åç”¨å…·ä½“çš„ç¤ºä¾‹é˜è¿°äº†å¸¸ç”¨çš„å‘½ä»¤ç”¨æ³•ï¼Œæœ€åé€šè¿‡ä¸€ä¸¤ä¸ªæ¡ˆä¾‹æ¥è¯´æ˜è¿™äº›å·¥å…·çš„å¼ºå¤§ä¹‹å¤„ï¼š
- æ¯”å¦‚ç»™å®šä¸€ä¸ª nginx æ—¥å¿—æ–‡ä»¶ï¼Œèƒ½å¤Ÿæ‰¾å‡º HTTP 404 è¯·æ±‚æœ€å¤šçš„ top 10 æ˜¯ä»€ä¹ˆ? æ¯”å¦‚èƒ½æ‰¾åˆ°è¯·æ±‚è€—æ—¶æœ€å¤šçš„ top 10æ˜¯ä»€ä¹ˆ? 
- å†æ¯”å¦‚èƒ½å¤Ÿç®€å•çš„å¾—åˆ°æ¯å°æ—¶çš„"PV"æ˜¯å¤šå°‘? å†æ¯”å¦‚æ‹¿åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œ èƒ½å¦ç®€å•ç»Ÿè®¡ä¸€ä¸‹è¿™ç¯‡æ–‡ç« å•æ¬¡è¯é¢‘æœ€é«˜çš„10ä¸ªè¯è¯­æ˜¯ä»€ä¹ˆ?
- éœ€è¦æ‰¹é‡æ”¹æŸä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åï¼Œæ‰¹é‡å°†æ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡å‹ç¼©æˆå›ºå®šå¤§å°çš„ï¼Œç­‰ç­‰ã€‚


## Mac ç¯å¢ƒ

- zsh
- on-my-zsh
- plugin 
    - git
    - autojump
    - osx(man-preview/quick-look/pfd(print Finder director)/cdf(cd Finder))
- å¸¸ç”¨å¿«æ·é”®(`bindkey`)
- æ¼”ç¤º: é«˜äº®/git/æ™ºèƒ½è¡¥å…¨/è·³è½¬(j, d)...

è¿™é‡Œç»™å¤§å®¶å±•ç¤ºä¸€ä¸ªå° Demoï¼Œä¹‹å‰åœ¨è§†é¢‘å·ï¼ˆç¨‹åºçŒ¿çŸ³å¤´ï¼Œæ¬¢è¿å…³æ³¨ï¼‰ä¸­åˆ†äº«çš„ä¸€ä¸ªå°è§†é¢‘ï¼Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨ç›®å½•ä¹‹é—´å¿«é€Ÿè·³è½¬ã€‚

å…³äº Mac ç¨‹åºçŒ¿æé«˜æ•ˆç‡çš„ç›¸å…³æŠ€å·§ï¼Œæ›´å¤šçš„å¯ä»¥å‚è€ƒä»¥ä¸‹ä¸‰ç¯‡æ–‡ç« ï¼š

- [å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ -- Mac è½¯ä»¶æ¨èï¼ˆåºï¼‰](https://mp.weixin.qq.com/s?__biz=MzI3OTUzMzcwNw==&mid=2247485871&idx=1&sn=c877775df684d8ab8c90bf2d38eee98a&chksm=eb47084bdc30815d19182c51571b096a20b79bdee0956f68167ebc8ed3117364ac0602f83658&token=551126633&lang=zh_CN&scene=21#wechat_redirect)
- [æœ‰äº†è¿™å‡ ä¸ªç¥å™¨ï¼Œç¬é—´é€¼æ ¼å°±ä¸Šå»äº†](https://mp.weixin.qq.com/s?__biz=MzI3OTUzMzcwNw==&mid=2247486659&idx=1&sn=b574d3f2a6af4544ceab48aadaa0a726&chksm=eb470d27dc308431e8789a87e32a597c72cc0f2fe02d6fc80424aec11e41e712326b62603f27&token=551126633&lang=zh_CN&scene=21#wechat_redirect)
- [ä¼˜ç§€çš„ç¨‹åºå‘˜æ˜¯å¦‚ä½•åˆ©ç”¨å·¥å…·æ¥æå‡å·¥ä½œæ•ˆç‡çš„ï¼Ÿ
](https://mp.weixin.qq.com/s?__biz=MzI3OTUzMzcwNw==&mid=2247487786&idx=1&sn=842202cc524477ec1546b4747bdbf1a8&chksm=eb4710cedc3099d86953451729c7f569866e6e58abbbec5c7ebe7423d12e1f11e189bb417f80&token=242044315&lang=zh_CN#rd)

## Shell åŸºç¡€å‘½ä»¤

- which/whereisï¼Œ å¸¸ç”¨ `whatis`ï¼Œ `man`ï¼Œ `--help`

    ```bash
    âœ  .oh-my-zsh git:(master)$ whereis ls
    /bin/ls
    âœ  .oh-my-zsh git:(master)$ which ls
    ls: aliased to ls -G
    ```

- åŸºæœ¬æ–‡ä»¶ç›®å½•æ“ä½œ

    ```bash
    rmï¼Œ mkdirï¼Œ mvï¼Œ cpï¼Œ cdï¼Œ lsï¼Œ lnï¼Œ fileï¼Œ statï¼Œ wc(-l/w/c)ï¼Œ headï¼Œ moreï¼Œ tailï¼Œ cat...
    ```

- åˆ©å™¨ ç®¡é“: `|`

## Shell æ–‡æœ¬å¤„ç†

è¿™é‡Œå°±æ˜¯é€šè¿‡æ¡ˆä¾‹è®²äº†ä¸€ä¸‹12ä¸ªå‘½ä»¤çš„å¤§è‡´ç”¨æ³•å’Œå‚æ•°ï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»å³è¾¹çš„ç›®å½•ï¼ˆæˆ‘åšå®¢æœ‰ç›®å½•ï¼Œå…¬ä¼—å·ä¸Šæœ¨æœ‰ï¼‰ç›´è¾¾ä½ æƒ³è¦äº†è§£çš„å‘½ä»¤ã€‚

```
find, grep, xargs, cut, paste, comm
join, sort, uniq, tr, sed, awk
```

### find

- å¸¸ç”¨å‚æ•°
	- æ–‡ä»¶å `-name`ï¼Œ æ–‡ä»¶ç±»å‹`-type`ï¼Œ æŸ¥æ‰¾æœ€å¤§æ·±åº¦`-maxdepth`
    - æ—¶é—´è¿‡æ»¤(create/access/modify) `-[cam]time`
    - æ‰§è¡ŒåŠ¨ä½œ `-exec`
- ç¤ºä¾‹

    ```bash
    find ./ -name "*.json"
    find . -maxdepth 7 -name "*.json" -type f
    find . -name "*.log.gz" -ctime +7 -size +1M -delete (atime/ctime/mtime)
    find . -name "*.scala" -atime -7 -exec du -h {} \;
    ```

### grep

- å¸¸ç”¨å‚æ•°

	- -v(invert-match)ï¼Œ 
	- -c(count)ï¼Œ 
	- -n(line-number)ï¼Œ 
	- -i(ignore-case)ï¼Œ 
	- -lï¼Œ -Lï¼Œ -R(-rï¼Œ --recursive)ï¼Œ -e

- ç¤ºä¾‹

    ```bash
    grep 'partner' ./*.scala -l
    grep -e 'World' -e 'first' -i -R ./  (-e: or)
    ```

- ç›¸å…³å‘½ä»¤: `grep -z / zgrep / zcat xx | grep`

### xargs 

- å¸¸ç”¨å‚æ•°
    - -n(æ¯è¡Œåˆ—æ•°)ï¼Œ 
	- -I(å˜é‡æ›¿æ¢)
	- -d(åˆ†éš”ç¬¦)ï¼Œ Mac ä¸æ”¯æŒï¼Œæ³¨æ„ä¸GNUç‰ˆæœ¬çš„åŒºåˆ«

- ç¤ºä¾‹    

    ```bash
    find . -type f -name "*.jpg" | xargs -n1 -I {} du -sh {}
    ```

### cut

-  å¸¸ç”¨å‚æ•°
    - -b(å­—èŠ‚)
    - -c(å­—ç¬¦)
    - -f(ç¬¬å‡ åˆ—)ï¼Œ-d(åˆ†éš”ç¬¦)ï¼Œf èŒƒå›´: `n, n-, -m, n-m`

-  ç¤ºä¾‹    

    ```bash
    echo "helloworldhellp" | cut -c1-10
    cut -dï¼Œ -f2-8 csu.db.export.csv
    ```

### paste

-  å¸¸ç”¨å‚æ•°

    - -d åˆ†éš”ç¬¦
    - -s åˆ—è½¬è¡Œ

-  ç¤ºä¾‹

    ```bash
    âœ  Documents$ cat file1
    1 11
    2 22
    3 33
    4 44
    âœ  Documents$ cat file2
    one     1
    two     2
    three   3
    one1    4

    âœ  Documents$ paste -d, file1 file2
    1 11, one     1
    2 22, two     2
    3 33, three   3
    4 44, one1    4
    âœ  Documents$ paste -s -d: file1 file2
    a 11:b bb:3 33:4 44
    one     1:two     2:three   3:one1    4
    ```

### join 

ç±»ä¼¼sqlä¸­çš„ `...inner join ...on ...`ï¼Œ `-t` åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼æˆ–tab

```bash
âœ  Documents$ cat j1
1 11
2 22
3 33
4 44
5 55
âœ  Documents$ cat j2
one     1   0
one     2   1
two     4   2
three   5   3
one1    5   4
âœ  Documents$ join -1 1 -2 3 j1 j2
1 11 one 2
2 22 two 4
3 33 three 5
4 44 one1 5
```


### comm

- å¸¸ç”¨å‚æ•°
	- ç”¨æ³• `comm [-123i] file1 file2`
	- **å­—å…¸åºåˆ—**ï¼Œ 3åˆ—: åªåœ¨file1/file2/both
	- `-` å»æ‰æŸåˆ—ï¼Œ`i` å¿½ç•¥å¤§å°å†™

- ç¤ºä¾‹

    ```bash
    âœ  Documents$ seq 1 5 >file11
    âœ  Documents$ seq 2 6 >file22
    âœ  Documents$ cat file11
    1
    2
    3
    4
    5
    âœ  Documents$ cat file22
    2
    3
    4
    5
    6
    âœ  Documents$ comm file11 file22
    1
            2
            3
            4
            5
        6
    âœ  Documents$ comm -1 file11 file22
        2
        3
        4
        5
    6
    âœ  Documents$ comm -2 file11 file22
    1
        2
        3
        4
        5
    âœ  Documents$ comm -23 file11 file22
    1
    ```

ç›¸å…³å‘½ä»¤ **diff**(ç±»ä¼¼*git diff*)

### sort 

-  å¸¸ç”¨å‚æ•°
    - -dï¼Œ --dictionary-order
    - -nï¼Œ --numeric-sort
    - -rï¼Œ --reverse
    - -bï¼Œ --ignore-leading-blanks
    - -kï¼Œ --key
-  ç¤ºä¾‹

    ```bash
    âœ  Documents$ cat file2
    one     1
    two     2
    three   3
    one1    4
    âœ  Documents$ sort file2
    one     1
    one1    4
    three   3
    two     2
    âœ  Documents$ sort -b -k2 -r file2
    one1    4
    three   3
    two     2
    one     1
    ```

### uniq

-  å¸¸ç”¨å‚æ•°
	- -c é‡å¤æ¬¡æ•°
	- -d é‡å¤çš„
	- -u æ²¡é‡å¤çš„
	- -f å¿½ç•¥å‰å‡ åˆ—
-  ç¤ºä¾‹

    ```bash
    âœ  Documents$ cat file4
    11
    22
    33
    11
    11
    âœ  Documents$ sort file4 | uniq -c
       3 11
       1 22
       1 33
    âœ  Documents$ sort file4 | uniq -d
    11
    âœ  Documents$ sort file4 | uniq -u
    22
    33
    âœ  Documents$ cat file3
    one     1
    two     1
    three   3
    one1    4
    âœ  Documents$ uniq -c -f 1 file3
       2 one     1
       1 three   3
       1 one1    4
    ```

æ³¨æ„ï¼š`uniq`æ¯”è¾ƒç›¸é‚»çš„æ˜¯å¦é‡å¤ï¼Œä¸€èˆ¬ä¸`sort`è”ç”¨

### tr

-  å¸¸ç”¨å‚æ•°
    - -c è¡¥é›†
    - -d åˆ é™¤
    - -s å‹ç¼©ç›¸é‚»é‡å¤çš„

-  ç¤ºä¾‹

    ```bash
    âœ  Documents$ echo '1111234444533hello' | tr  '[1-3]' '[a-c]'
    aaaabc44445cchello
    âœ  Documents$ echo '1111234444533hello' | tr -d '[1-3]'
    44445hello
    âœ  Documents$ echo '1111234444533hello' | tr -dc '[1-3]'
    11112333
    âœ  Documents$ echo '1111234444533hello' | tr -s '[0-9]'
    123453hello
    âœ  Documents$ echo 'helloworld' | tr '[:lower:]' '[:upper:]'
    HELLOWORLD
    ```

### sed

-  å¸¸ç”¨å‚æ•°
    - -d åˆ é™¤
    - -s æ›¿æ¢ï¼Œ g å…¨å±€
    - -e å¤šä¸ªå‘½ä»¤å åŠ 
    - -i ä¿®æ”¹åŸæ–‡ä»¶(Macä¸‹åŠ å‚æ•° ""ï¼Œå¤‡ä»½)
-  ç¤ºä¾‹

    ```bash
    âœ  Documents$ cat file2
    one     1
    two     2
    three   3
    one1    4
    âœ  Documents$ sed "2,3d" file2
    one     1
    one1    4
    âœ  Documents$ sed '/one/d' file2
    two     2
    three   3
    âœ  Documents$ sed 's/one/111/g' file2
    111     1
    two     2
    three   3
    1111    4
    #å°†oneæ›¿æ¢æˆ111 å¹¶å°†å«æœ‰twoçš„è¡Œåˆ é™¤
    âœ  Documents$ sed -e 's/one/111/g' -e '/two/d' file2
    111     1
    three   3
    1111    4
    # ()æ ‡è®°(è½¬ä¹‰), \1 å¼•ç”¨
    âœ  Documents$ sed 's/\([0-9]\)/\1.html/g' file2
    one     1.html
    two     2.html
    three   3.html
    one1.html    4.html
    # ä¸ä¸Šé¢ä¸€æ · & æ ‡è®°åŒ¹é…çš„å­—ç¬¦
    âœ  Documents$ sed 's/[0-9]/&.html/g' file2
    one     1.html
    two     2.html
    three   3.html
    one1.html    4.html
    âœ  Documents$ cat mobile.csv
    "13090246026"
    "18020278026"
    "18520261021"
    "13110221022"
    âœ  Documents$ sed 's/\([0-9]\{3\}\)[0-9]\{4\}/\1xxxx/g' mobile.csv
    "130xxxx6026"
    "180xxxx8026"
    "185xxxx1021"
    "131xxxx1022"
    ```

### awk

-  åŸºæœ¬å‚æ•°å’Œè¯­æ³•
    - NR è¡Œå·ï¼Œ NF åˆ—æ•°é‡
    - `$1` ç¬¬1åˆ—ï¼Œ `$2, $3`...
    - -F fs  fsåˆ†éš”ç¬¦ï¼Œå­—ç¬¦ä¸²æˆ–æ­£åˆ™
	- è¯­æ³•:  `awk 'BEGIN{ commands } pattern{ commands } END{ commands }'`ï¼Œ æµç¨‹å¦‚ä¸‹:
		1. æ‰§è¡Œbegin
		2. å¯¹è¾“å…¥æ¯ä¸€è¡Œæ‰§è¡Œ `pattern{ commands } `ï¼Œ pattern å¯ä»¥æ˜¯ æ­£åˆ™`/reg exp/`ï¼Œ å…³ç³»è¿ç®—ç­‰
		3. å¤„ç†å®Œæ¯•ï¼Œ æ‰§è¡Œ end

-  ç¤ºä¾‹

    ```bash
    âœ  Documents$ cat file5
    11  11 aa cc
    22  22 bb
    33  33 d
    11  11
    11  11
    #è¡Œå·ï¼Œ åˆ—æ•°é‡ï¼Œ ç¬¬3åˆ—
    âœ  Documents$ awk '{print NR"("NF"):"ï¼Œ $3}' file5
    1(4): aa
    2(3): bb
    3(3): d
    4(2):
    5(2):
    #å­—ç¬¦ä¸²åˆ†å‰²ï¼Œ æ‰“å°1ï¼Œ2åˆ—
    âœ  Documents$ awk -F"xxxx" '{print $1ï¼Œ $2}' mobile.csv
    "130 6026"
    "180 8026"
    "185 1021"
    "131 1022"
    #æ·»åŠ è¡¨è¾¾å¼
    âœ  Documents$ awk '$1>=22 {print NR":"ï¼Œ $3}' file5
    2: bb
    3: d
    #ç´¯åŠ 1åˆ°36ï¼Œå¥‡æ•°ï¼Œå¶æ•°
    âœ  Documents$ seq 36 | awk 'BEGIN{sum=0; print "question:"} {print $1" +"; sum+=$1} END{print "="; print sum}' | xargs | sed 's/+ =/=/'
    question: 1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 9 + 10 + 11 + 12 + 13 + 14 + 15 + 16 + 17 + 18 + 19 + 20 + 21 + 22 + 23 + 24 + 25 + 26 + 27 + 28 + 29 + 30 + 31 + 32 + 33 + 34 + 35 + 36 = 666
    âœ  Documents$ seq 36 | awk 'BEGIN{sum=0; print "question:"} $1 % 2 ==1 {print $1" +"; sum+=$1} END{print "="; print sum}' | xargs | sed 's/+ =/=/'
    question: 1 + 3 + 5 + 7 + 9 + 11 + 13 + 15 + 17 + 19 + 21 + 23 + 25 + 27 + 29 + 31 + 33 + 35 = 324
    âœ  Documents$ seq 36 | awk 'BEGIN{sum=0; print "question:"} $1 % 2 !=1 {print $1" +"; sum+=$1} END{print "="; print sum}' | xargs | sed 's/+ =/=/'
    question: 2 + 4 + 6 + 8 + 10 + 12 + 14 + 16 + 18 + 20 + 22 + 24 + 26 + 28 + 30 + 32 + 34 + 36 = 342
    ```

å…¶ä»–é«˜çº§è¯­æ³•ï¼š`for, while` ç­‰ï¼Œ å„ç§å‡½æ•°ç­‰ï¼Œæœ¬èº«`awk`æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è¯­è¨€ï¼Œå¯ä»¥æŒæ¡ä¸€äº›åŸºæœ¬çš„ç”¨æ³•ã€‚

## å®é™…åº”ç”¨

### æ—¥å¿—ç»Ÿè®¡åˆ†æ

ä¾‹å¦‚æ‹¿åˆ°ä¸€ä¸ªnginxæ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚çœ‹å“ªäº›è¯·æ±‚æ˜¯è€—æ—¶æœ€ä¹…çš„è¿›è€Œè¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚çœ‹æ¯å°æ—¶çš„"PV"æ•° ç­‰ç­‰ã€‚

```bash
âœ  Documents$ head -n5 std.nginx.log
106.38.187.225 - - [20/Feb/2017:03:31:01 +0800] www.tanglei.name "GET /baike/208344.html HTTP/1.0" 301 486 "-" "Mozilla/5.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 1.1.4322) 360JK yunjiankong 975382" "106.38.187.225, 106.38.187.225" - 0.000
106.38.187.225 - - [20/Feb/2017:03:31:02 +0800] www.tanglei.name "GET /baike/208344.html HTTP/1.0" 301 486 "-" "Mozilla/5.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 1.1.4322) 360JK yunjiankong 975382" "106.38.187.225, 106.38.187.225" - 0.000
10.130.64.143 - - [20/Feb/2017:03:31:02 +0800] stdbaike.bdp.cc "POST /baike/wp-cron.php?doing_wp_cron=1487532662.2058920860290527343750 HTTP/1.1" 200 182 "-" "WordPress/4.5.6; http://www.tanglei.name/baike" "10.130.64.143" 0.205 0.205
10.130.64.143 - - [20/Feb/2017:03:31:02 +0800] www.tanglei.name "GET /external/api/login-status HTTP/1.0" 200 478 "-" "-" "10.130.64.143" 0.003 0.004
10.130.64.143 - - [20/Feb/2017:03:31:02 +0800] www.tanglei.name "GET /content_util/authorcontents?count=5&offset=0&israndom=1&author=9 HTTP/1.0" 200 11972 "-" "-" "10.130.64.143" 0.013 0.013
```

ä¸Šé¢æ˜¯nginxçš„ä¸€ä¸ªæ¡ˆä¾‹ï¼Œ ä¾‹å¦‚å¸Œæœ›æ‰¾åˆ°top 10 è¯·æ±‚çš„path:

```bash
head -n 10000 std.nginx.log | awk '{print $8 ", " $10}' | grep ',404' | sort | uniq -c | sort -nr -k1 | head -n 10
#or
head -n 10000 std.nginx.log | awk '$10==404 {print $8}' |sort | uniq -c | sort -nr -k1 | head -n 10
```

å½“ç„¶ï¼Œä½ å¯èƒ½ä¸€æ¬¡ä¸ä¼šç›´æ¥å¤„ç†æˆåŠŸï¼Œä¸€èˆ¬ä¼šå…ˆå°‘æ‹¿ä¸€éƒ¨åˆ†æ•°æ®è¿›è¡Œå¤„ç†çœ‹é€»è¾‘æ˜¯å¦æ­£å¸¸ï¼Œ æˆ–è€…ä½ å¯ä»¥ç¼“å­˜ä¸€äº›ä¸­é—´ç»“æœ. 

```bash
cat std.nginx.log | awk '{print $8 "," $10}' | grep ',404' >404.log
sort 404.log | uniq -c | sort -nr -k1 | head -n 10
```

å†æ¯”å¦‚æ¯å°æ—¶è¯·æ±‚æ•°é‡ï¼Œè¯·æ±‚è€—æ—¶ç­‰ç­‰

```bash
âœ  Documents$ head -n 100000 std.nginx.log | awk -F: '{print $1 $2}' | cut -f3 -d/ | uniq -c
8237 201703
15051 201704
16083 201705
18561 201706
22723 201707
19345 201708
```

å…¶ä»–å®é™…æ¡ˆä¾‹ ip block

### æ¡ˆä¾‹: dbæ•°æ®è®¢æ­£

èƒŒæ™¯: å› ä¸ºæŸæœåŠ¡bugï¼Œå¯¼è‡´æ’å…¥åˆ°dbçš„å›¾ç‰‡è·¯å¾„ä¸å¯¹ï¼Œéœ€è¦å°†å½¢å¦‚(å®‰å…¨éœ€è¦å·²ç»å°†æ•æ„Ÿæ•°æ®æ›¿æ¢)
`https://www.tanglei.name/upload/photos/129630//internal-public/shangtongdai/2017-02-19-abcdefg-eb85-4c24-883e-hijklmn.jpg`
æ›¿æ¢æˆ
`http://www.tanglei.me/internal-public/shangtongdai/2017-02-19-abcdefg-eb85-4c24-883e-hijklmn.jpg`ï¼Œå› ä¸ºmysqlç­‰dbè²Œä¼¼ä¸æ”¯æŒç›´æ¥æ­£åˆ™çš„æ›¿æ¢ï¼Œæ‰€ä»¥ä¸èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„è¿›è¡Œå†™sqlè¿›è¡Œæ›¿æ¢ï¼ˆå°±ç®—æ”¯æŒï¼Œç›´æ¥æ”¹ä¹Ÿæœ‰é£é™©çš„ï¼Œè¿˜æ˜¯å…ˆå¤‡ä»½å†ä¿®æ”¹ç•™ä¸ªâ€œåæ‚”è¯â€ï¼‰ã€‚

å½“ç„¶å°†æ•°æ®å¯¼å‡ºï¼Œç„¶åå†™ python ç­‰è„šæœ¬å¤„ç†ä¹Ÿæ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†å¦‚æœç”¨ä¸Šé¢çš„å‘½ä»¤è¡Œå¤„ç†ï¼Œåªéœ€è¦å‡ åç§’å³å¯å®Œæˆã€‚

æ­¥éª¤:

1. å‡†å¤‡æ•°æ®

	```sql
	select id, photo_url_1, photo_url_2, photo_url_3 from somedb.sometable where 
	photo_url_1 like 'https://www.tanglei.name/upload/photos/%//internal-public/%' or
	photo_url_2 like 'https://www.tanglei.name/upload/photos/%//internal-public/%' or
	photo_url_3 like 'https://www.tanglei.name/upload/photos/%//internal-public/%';
	```
2. æ›¿æ¢åŸæ–‡ä»¶ 
    ä¸€èˆ¬åœ¨ç”¨sedæ›¿æ¢çš„æ—¶å€™ï¼Œå…ˆæµ‹è¯•ä¸€ä¸‹æ˜¯å¦æ­£å¸¸æ›¿æ¢ã€‚ 

	```bash
    #æµ‹è¯•æ˜¯å¦OK
    head -n 5 customers.csv | sed 's|https://www.tanglei.name/upload/photos/[0-9]\{1,\}/|http://www.tanglei.me|g'
    # ç›´æ¥æ›¿æ¢åŸæ–‡ä»¶ï¼Œ å¯ä»¥sed -i ".bak" æ›¿æ¢æ—¶ä¿ç•™åŸå§‹å¤‡ä»½æ–‡ä»¶
    sed -i "" 's|https://www.tanglei.name/upload/photos/[0-9]\{1,\}/|http://www.tanglei.me|g' customers.csv
	```
3. æ‹¼æ¥sqlï¼Œ ç„¶åæ‰§è¡Œ

	```bash
    awk -Fï¼Œ '{print "update sometable set photo_url_1 = " $2, ", photo_url_2 = " $3, ", photo_url_3 = " $4, " where id = " $1 ";" }' customers.csv > customer.sql
    #ç„¶åæ‰§è¡Œsql å³å¯
	```

### å…¶ä»–

- play framework session

    - è€æ–¹å¼: éœ€è¦å¯playç¯å¢ƒï¼Œ æ…¢

	```scala
	sbt "project site" consoleQuick
	import play.api.libs._
	val sec = "secret...secret"
	var uid = "10086"
	Crypto.sign(s"uid=$uid"ï¼Œ sec.getBytes("UTF-8")) + s"-uid=$uid"
	```
	- æ–°æ–¹å¼: 

	```bash
	âœ  Documents$  ~/stdcookie.sh 97522
	918xxxxdf64abcfcxxxxc465xx7554dxxxx21e-uid=97522
	âœ  Documents$ cat ~/stdcookie.sh
	#!/bin/bash ##  cannot remove this line
	uid=$1
	hash=`echo -n "uid=$uid" | openssl dgst -sha1 -hmac "secret...secret"`
	echo "$hash-uid=$uid"
	```

- ç»Ÿè®¡æ–‡ç« å•è¯é¢‘ç‡: ä¸‹é¢æ¡ˆä¾‹ç»Ÿè®¡äº†å·æ™®å°±èŒæ¼”è®²åŸæ–‡ä¸­è¯é¢‘æœ€é«˜çš„10ä¸ªè¯ã€‚

	```bash
	âœ  Documents$ head -n3 chuanpu.txt
	Chief Justice Robertsï¼Œ President Carterï¼Œ President Clintonï¼Œ President Bushï¼Œ President Obamaï¼Œ fellow Americans and people of the worldï¼Œ thank you.
	
	Weï¼Œ the citizens of Americaï¼Œ are now joined in a great national effort to rebuild our country and restore its promise for all of our people. Together we will determine the course of America and the world for manyï¼Œ many years to come.
	âœ  Documents$ cat chuanpu.txt | tr -dc 'a-zA-Z ' | xargs -n 1 | sort | uniq -c | sort -nr -k1 | head -n 20
	  65 the
	  63 and
	  48 of
	  46 our
	  42 will
	  37 to
	  21 We
	  20 is
	  18 we
	  17 America
	  15 a
	  14 all
	  13 in
	  13 for
	  13 be
	  13 are
	  10 your
	  10 not
	  10 And
	  10 American
	```

- éšæœºæ•°ï¼šæ¯”å¦‚å¸¸å¸¸æ–°æ³¨å†Œä¸€ä¸ªç½‘ç«™ï¼Œéšæœºç”Ÿæˆä¸€ä¸ªå¯†ç ä¹‹ç±»çš„ã€‚  

	```bash
	âœ  Documents$ cat /dev/urandom | LC_CTYPE=C tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 5
	cpBnvC0niwTybSSJhUUiZwIz6ykJxBvu
	VDP56NlHnugAt2yDySAB9HU2Nd0LlYCW
	0WEDzpjPop32T5STvR6K6SfZMyT6KvAI
	a9xBwBat7tJVaad279fOPdA9fEuDEqUd
	hTLrOiTH5FNP2nU3uflsjPUXJmfleI5c
	âœ  Documents$ cat /dev/urandom | head -c32 | base64
	WoCqUye9mSXI/WhHODHDjzLaSb09xrOtbrJagG7Kfqc=
	```

- å›¾ç‰‡å¤„ç†å‹ç¼©ï¼Œå¯æ‰¹é‡æ”¹å›¾ç‰‡å¤§å°ç­‰ç­‰ `sips`
	
	```bash
	âœ  linux-shell-more-effiency$ sips -g all which-whereis.png
	/Users/tanglei/Documents/linux-shell-more-effiency/which-whereis.png
	  pixelWidth: 280
	  pixelHeight: 81
	  typeIdentifier: public.png
	  format: png
	  formatOptions: default
	  dpiWidth: 72.000
	  dpiHeight: 72.000
	  samplesPerPixel: 4
	  bitsPerSample: 8
	  hasAlpha: yes
	  space: RGB
	  profile: DELL U2412M
	âœ  linux-shell-more-effiency$ sips -Z 250 which-whereis.png
	/Users/tanglei/Documents/linux-shell-more-effiency/which-whereis.png
	  /Users/tanglei/Documents/linux-shell-more-effiency/which-whereis.png
	âœ  linux-shell-more-effiency$ sips -g all which-whereis.png
	/Users/tanglei/Documents/linux-shell-more-effiency/which-whereis.png
	  pixelWidth: 250
	  pixelHeight: 72
	  typeIdentifier: public.png
	  format: png
	  formatOptions: default
	  dpiWidth: 72.000
	  dpiHeight: 72.000
	  samplesPerPixel: 4
	  bitsPerSample: 8
	  hasAlpha: yes
	  space: RGB
	  profile: DELL U2412M
	âœ  linux-shell-more-effiency$ sips -z 100 30 which-whereis.png
	/Users/tanglei/Documents/linux-shell-more-effiency/which-whereis.png
	  /Users/tanglei/Documents/linux-shell-more-effiency/which-whereis.png
	âœ  linux-shell-more-effiency$ sips -g pixelWidth -g pixelHeight which-whereis.png
	/Users/tanglei/Documents/linux-shell-more-effiency/which-whereis.png
	  pixelWidth: 30
	  pixelHeight: 100
	```

- å‘½ä»¤è¡Œå¤„ç† JSON çš„ç¥å™¨ï¼šéšç€ JSON é€šç”¨æ€§ï¼Œå¸¸å¸¸éœ€è¦å¤„ç† JSON æ•°æ®ï¼Œè¿™é‡Œæ¨èè¿™ä¸ªå‘½ä»¤è¡Œ JSON å¤„ç†ç¥å™¨[jq is a lightweight and flexible command-line JSON processor](https://stedolan.github.io/jq/ "jq is a lightweight and flexible command-line JSON processor")
- å…¶ä»–è¿˜æœ‰ä¸€ä¸ªç»¼åˆåº”ç”¨å¯å‚è€ƒï¼š[æ²¡æƒ³åˆ° Shell å‘½ä»¤ç«Ÿç„¶è¿˜èƒ½è¿™ä¹ˆç©ï¼Ÿ| Shell ç©è½¬å¤§æ•°æ®åˆ†æ
](https://mp.weixin.qq.com/s?__biz=MzI3OTUzMzcwNw==&mid=2247488114&idx=1&sn=b6191483135ecd7f7c0b735bc2dbe7a7&chksm=eb471396dc309a80ba8df35f9e04ab585a80cb3f9e485fdf4c9afd380200c2d109b28335a00b&token=242044315&lang=zh_CN#rd)


æ¨èä»¥ä¸‹å‚è€ƒææ–™ï¼š

- [1] JSON processor: https://stedolan.github.io/jq/
- [2] Linuxå·¥å…·å¿«é€Ÿæ•™ç¨‹: http://linuxtools-rst.readthedocs.io/zh_CN/latest/index.html
- [3] Linuxå‘½ä»¤å¤§å…¨: http://man.linuxde.net/
- [4] Advanced Bash-Scripting Guide: http://tldp.org/LDP/abs/html/
- [5] UNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹: https://book.douban.com/subject/25900403


é€å‡ æœ¬æˆ‘ä»¬éƒ¨é—¨å‡ºçš„æ–°ä¹¦ï¼Œå…è´¹åŒ…é‚®åˆ°å®¶ï¼Œæ¬¢è¿å¤§å®¶æ¥æŠ½å¥–ï¼ˆä¸¤ç§æŠ½å¥–æ–¹å¼ï¼Œè¯¦æƒ…è§ä¸‹æ–‡ï¼‰ï¼Œä¹Ÿå¸®å¿™reviewä¸‹æŠ½å¥–çš„ä»£ç ã€‚

[å…³äº AI çš„æ•°ç™¾ä¸ªé—®é¢˜ï¼Œæ¸…åç”·ç¥åˆ˜äº‘æµ©æ•™æˆçš„ 3 ä¸‡å­—å›å¤ç»™æ•´å¾—æ˜æ˜ç™½ç™½|é™„æŠ½å¥–é€ä¹¦](https://mp.weixin.qq.com/s?__biz=MzI3OTUzMzcwNw==&mid=2247488892&idx=1&sn=1b026c5a8688b880ca06c51c816265b1&chksm=eb471498dc309d8eaac5bd296a3971901e624e9abfc5a0add8928f5ebc3a83b8402ebfadd95d&scene=21&token=1758347384&lang=zh_CN#wechat_redirect)

ä¸Šæ–‡æ˜¯ä¸€ä¸ªè¶…çº§å¤§ç‰›å…³äºAIçš„ç›¸å…³é—®é¢˜è§£ç­”ï¼ŒæŠ½å¥–æ´»åŠ¨åœ¨æ–‡æœ«ã€‚ç›´æ¥å…¬ä¼—å·åå°å›å¤â€œæŠ½å¥–â€ ä¹Ÿæ˜¯å…¶ä¸­ä¸€ç§æŠ½å¥–æ–¹å¼å“¦ã€‚ 

è§‰å¾—æœ¬å·åˆ†äº«çš„æ–‡ç« æœ‰ä»·å€¼ï¼Œè®°å¾—æ·»åŠ æ˜Ÿæ ‡å“¦ã€‚å‘¨æ›´å¾ˆç´¯ï¼Œä¸è¦ç™½ piaoï¼Œéœ€è¦æ¥ç‚¹æ­£åé¦ˆï¼Œå®‰æ’ä¸ª â€œä¸€é”®ä¸‰è¿â€ï¼ˆç‚¹èµã€åœ¨çœ‹ã€åˆ†äº«ï¼‰å¦‚ä½•ï¼ŸğŸ˜ è¿™å°†æ˜¯æˆ‘æŒç»­è¾“å‡ºä¼˜è´¨æ–‡ç« çš„æœ€å¼ºåŠ¨åŠ›ã€‚
